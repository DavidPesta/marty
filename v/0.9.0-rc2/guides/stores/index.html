<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Stores | marty.js</title>
  <meta name="viewport" content="width=device-width">

  <link rel="shortcut icon" href="/v/0.9.0-rc2/favicon.ico?v=1" type="image/x-icon">

  <link rel="stylesheet" type="text/css" href="/v/0.9.0-rc2/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="/v/0.9.0-rc2/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="/v/0.9.0-rc2/css/codemirror.css">
  <link rel="stylesheet" type="text/css" href="/v/0.9.0-rc2/css/docs.css">

  <script type="text/javascript" src="/v/0.9.0-rc2/js/codemirror.js"></script>
</head>
<body>

  
  <header class="navbar navbar-static-top bs-docs-nav" id="top" role="banner">
    <div class="container">
      <div class="navbar-header">
        <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a href="/v/0.9.0-rc2/" class="navbar-brand">marty.js</a>
      </div>
      <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
        <ul class="nav navbar-nav">
          <li class="active">
            <a href="/v/0.9.0-rc2/guides/getting-started">Guides</a>
            <ul class="nav sub-nav visible-xs-block">
              
              
                <li >
                  

                  <a  href="/v/0.9.0-rc2/guides/getting-started/index.html">
                    Getting Started
                  </a>
                </li>
              
                <li >
                  

                  <a  href="/v/0.9.0-rc2/guides/flux/index.html">
                    Flux
                  </a>
                </li>
              
                <li  class="active">
                  

                  <a  class="active" href="/v/0.9.0-rc2/guides/stores/index.html">
                    Stores
                  </a>
                </li>
              
                <li >
                  

                  <a  href="/v/0.9.0-rc2/guides/action-creators/index.html">
                    Action Creators
                  </a>
                </li>
              
                <li >
                  

                  <a  href="/v/0.9.0-rc2/guides/queries/index.html">
                    Queries
                  </a>
                </li>
              
                <li >
                  

                  <a  href="/v/0.9.0-rc2/guides/component/index.html">
                    Component
                  </a>
                </li>
              
                <li >
                  

                  <a  href="/v/0.9.0-rc2/guides/state-mixin/index.html">
                    State Mixin
                  </a>
                </li>
              
                <li >
                  

                  <a  href="/v/0.9.0-rc2/guides/state-sources/index.html">
                    State Sources
                  </a>
                </li>
              
                <li >
                  

                  <a  href="/v/0.9.0-rc2/guides/isomorphism/index.html">
                    Isomorphism
                  </a>
                </li>
              
                <li >
                  

                  <a  href="/v/0.9.0-rc2/guides/es6/index.html">
                    ES6
                  </a>
                </li>
              
                <li >
                  

                  <a  href="/v/0.9.0-rc2/guides/constants/index.html">
                    Constants
                  </a>
                </li>
              
                <li >
                  

                  <a  href="/v/0.9.0-rc2/guides/dispatcher/index.html">
                    Dispatcher
                  </a>
                </li>
              
                <li >
                  

                  <a  href="/v/0.9.0-rc2/guides/further-reading/index.html">
                    Further reading
                  </a>
                </li>
              
            </ul>
          </li>
          <li>
            <a href="/v/0.9.0-rc2/api/top-level-api">API</a>
            <ul class="nav sub-nav visible-xs-block">
              
              
                <li >
                  

                  <a  href="/v/0.9.0-rc2/api/top-level-api/index.html">
                    Top-Level API
                  </a>
                </li>
              
                <li >
                  

                  <a  href="/v/0.9.0-rc2/api/stores/index.html">
                    Stores
                  </a>
                </li>
              
                <li >
                  

                  <a  href="/v/0.9.0-rc2/api/action-creators/index.html">
                    Action Creators
                  </a>
                </li>
              
                <li >
                  

                  <a  href="/v/0.9.0-rc2/api/queries/index.html">
                    Queries
                  </a>
                </li>
              
                <li >
                  

                  <a  href="/v/0.9.0-rc2/api/component/index.html">
                    Component
                  </a>
                </li>
              
                <li >
                  

                  <a  href="/v/0.9.0-rc2/api/state-mixin/index.html">
                    State Mixin
                  </a>
                </li>
              
                <li >
                  

                  <a  href="/v/0.9.0-rc2/api/state-sources/index.html">
                    State Sources
                  </a>
                </li>
              
                <li >
                  

                  <a  href="/v/0.9.0-rc2/api/context/index.html">
                    Context
                  </a>
                </li>
              
                <li >
                  

                  <a  href="/v/0.9.0-rc2/api/container/index.html">
                    Container
                  </a>
                </li>
              
                <li >
                  

                  <a  href="/v/0.9.0-rc2/api/dispatcher/index.html">
                    Dispatcher
                  </a>
                </li>
              
                <li >
                  

                  <a  href="/v/0.9.0-rc2/api/constants/index.html">
                    Constants
                  </a>
                </li>
              
            </ul>
          </li>
          <li>
            <a href="/v/0.9.0-rc2/devtools">Developer Tools</a>
          </li>
          <li>
            

            <a href="/blog/2015/03/15/marty-v0.9.html">Blog</a>
          </li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li>
            <a href="http://github.com/jhollingworth/marty">
              <i class="fa fa-github"></i>
              Github
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </header>
  

<div class="container bs-docs-container">
  <div class="bs-docs-sidebar hidden-print col-md-2 hidden-xs col-xs-2">
    <ul class="sections-nav nav" role="navigation">
      
      
      

      
        

        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        

        <li  class="nav-section" >
          

          <a  href="/v/0.9.0-rc2/guides/getting-started/index.html">
              Getting Started
          </a>
          
        </li>
      
        

        
          
        
          
        
          
        
          
        
          
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        

        <li  class="nav-section" >
          

          <a  href="/v/0.9.0-rc2/guides/flux/index.html">
              Flux
          </a>
          
        </li>
      
        

        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            
          
        

        <li  class="nav-section active">
          

          <a  class="active" href="/v/0.9.0-rc2/guides/stores/index.html">
              Stores
          </a>
          
            <ul class="nav">
            
              
                <li>
                  <a 
                      href="/v/0.9.0-rc2/guides/stores/fetching-data.html">Fetching data</a>
                </li>
              
            
              
                <li>
                  <a 
                      href="/v/0.9.0-rc2/guides/stores/immutable-data-collections.html">Immutable data collections</a>
                </li>
              
            
              
              
            
            </ul>
          
        </li>
      
        

        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        

        <li  class="nav-section" >
          

          <a  href="/v/0.9.0-rc2/guides/action-creators/index.html">
              Action Creators
          </a>
          
            <ul class="nav">
            
              
                <li>
                  <a 
                      href="/v/0.9.0-rc2/guides/action-creators/actions-vs-action-creators.html">Actions vs. Action Creators</a>
                </li>
              
            
              
                <li>
                  <a 
                      href="/v/0.9.0-rc2/guides/action-creators/handling-errors.html">Handling Errors</a>
                </li>
              
            
              
              
            
              
                <li>
                  <a 
                      href="/v/0.9.0-rc2/guides/action-creators/migrating-from-v8.html">Migrating from Marty v0.8</a>
                </li>
              
            
            </ul>
          
        </li>
      
        

        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            
          
        
          
        
          
        
          
        

        <li  class="nav-section" >
          

          <a  href="/v/0.9.0-rc2/guides/queries/index.html">
              Queries
          </a>
          
        </li>
      
        

        
          
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        

        <li  class="nav-section" >
          

          <a  href="/v/0.9.0-rc2/guides/component/index.html">
              Component
          </a>
          
        </li>
      
        

        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            
          
        
          
        
          
        

        <li  class="nav-section" >
          

          <a  href="/v/0.9.0-rc2/guides/state-mixin/index.html">
              State Mixin
          </a>
          
        </li>
      
        

        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            
          
        
          
        

        <li  class="nav-section" >
          

          <a  href="/v/0.9.0-rc2/guides/state-sources/index.html">
              State Sources
          </a>
          
            <ul class="nav">
            
              
                <li>
                  <a 
                      href="/v/0.9.0-rc2/guides/state-sources/cookie-storage.html">Cookie State Source</a>
                </li>
              
            
              
                <li>
                  <a 
                      href="/v/0.9.0-rc2/guides/state-sources/cookie.html">JSON Storage State Source</a>
                </li>
              
            
              
                <li>
                  <a 
                      href="/v/0.9.0-rc2/guides/state-sources/http.html">HTTP State Source</a>
                </li>
              
            
              
              
            
              
                <li>
                  <a 
                      href="/v/0.9.0-rc2/guides/state-sources/json-storage.html">JSON Storage State Source</a>
                </li>
              
            
              
                <li>
                  <a 
                      href="/v/0.9.0-rc2/guides/state-sources/local-storage.html">Local Storage State Source</a>
                </li>
              
            
              
                <li>
                  <a 
                      href="/v/0.9.0-rc2/guides/state-sources/session-storage.html">Session Storage State Source</a>
                </li>
              
            
            </ul>
          
        </li>
      
        

        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            
          
        
          
        
          
        
          
        
          
        

        <li  class="nav-section" >
          

          <a  href="/v/0.9.0-rc2/guides/isomorphism/index.html">
              Isomorphism
          </a>
          
        </li>
      
        

        
          
        
          
        
          
        
          
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        

        <li  class="nav-section" >
          

          <a  href="/v/0.9.0-rc2/guides/es6/index.html">
              ES6
          </a>
          
        </li>
      
        

        
          
        
          
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        

        <li  class="nav-section" >
          

          <a  href="/v/0.9.0-rc2/guides/constants/index.html">
              Constants
          </a>
          
        </li>
      
        

        
          
        
          
        
          
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        

        <li  class="nav-section" >
          

          <a  href="/v/0.9.0-rc2/guides/dispatcher/index.html">
              Dispatcher
          </a>
          
        </li>
      
        

        
          
        
          
        
          
        
          
        
          
        
          
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        

        <li  class="nav-section" >
          

          <a  href="/v/0.9.0-rc2/guides/further-reading/index.html">
              Further reading
          </a>
          
        </li>
      
    </ul>
  </div>
  <div class="bs-docs-content col-md-10 col-s-10 col-xs-10" role="main">
    
      <h1 class="page-title">Stores</h1>
    
    <div class="content">
      <p>The store is where your state should live. It is also the only place that your state should <strong>change</strong>. Actions come in from the dispatcher and the store  decides whether to handle them or not. If the store does choose to handle an action and subsequently changes its state then it will notify any listeners that it has changed. Your views can then listen to those changes (via the <a href="/v/0.9.0-rc2/guides/state-mixin">State Mixin</a>) and then re-render themselves.</p>

<p>All of a store&#39;s state should live within <code>Store#state</code>. If you want to update the state you should use <code>Store#setState</code> which will update <code>this.state</code> and then notify any listeners that the store has changed. Or if you prefer you can update <code>this.state</code> and then manually call <code>this.hasChanged()</code></p>

<p>When you create a store it will automatically start listening to the dispatcher. To determine which actions to handle you define the <a href="/v/0.9.0-rc2/api/stores/#handlers">handlers</a> hash. The keys in handlers are the functions you wish to call when an action comes in and the values are <a href="/v/0.9.0-rc2/api/stores/#action-predicates">action predicates</a> (Normally the constant of the action&#39;s type). If your store does handle the action, then the arguments you passed to <a href="/v/0.9.0-rc2/api/action-creators/index.html#dispatch">ActionCreator#dispatch</a> are the arguments for the handler.</p>

<div class="sample">    <div class="btn-group zero-clipboard" role="group"> <button type="button" data-style="classic" class="btn btn-default classic">classic</button> <button type="button" data-style="es6" class="btn btn-default es6">es6</button> </div><div class="highlight" data-style="classic"><pre><code data-lang="js" class="language-js"><span class="kd">var</span> <span class="nx">UsersStore</span> <span class="o">=</span> <span class="nx">Marty</span><span class="p">.</span><span class="nx">createStore</span><span class="p">({</span>
  <span class="na">id</span><span class="p">:</span> <span class="s1">'UserStore'</span><span class="p">,</span>
  <span class="na">handlers</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">addUser</span><span class="p">:</span> <span class="nx">Constants</span><span class="p">.</span><span class="nx">RECEIVE_USER</span>
  <span class="p">},</span>
  <span class="na">getInitialState</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{};</span>
  <span class="p">},</span>
  <span class="na">addUser</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">[</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">user</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">hasChanged</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">listener</span> <span class="o">=</span> <span class="nx">UsersStore</span><span class="p">.</span><span class="nx">addChangeListener</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Users store changed'</span><span class="p">);</span>
  <span class="nx">listener</span><span class="p">.</span><span class="nx">dispose</span><span class="p">();</span>
<span class="p">});</span></code></pre></div><div class="highlight" data-style="es6"><pre><code data-lang="js" class="language-js"><span class="kr">class</span> <span class="nx">UsersStore</span> <span class="kr">extends</span> <span class="nx">Marty</span><span class="p">.</span><span class="nx">Store</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">handlers</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">addUser</span><span class="p">:</span> <span class="nx">Constants</span><span class="p">.</span><span class="nx">RECEIVE_USER</span>
    <span class="p">};</span>
  <span class="p">}</span>
  <span class="nx">addUser</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">[</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">user</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">hasChanged</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">listener</span> <span class="o">=</span> <span class="nx">UsersStore</span><span class="p">.</span><span class="nx">addChangeListener</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Users store changed'</span><span class="p">);</span>
  <span class="nx">listener</span><span class="p">.</span><span class="nx">dispose</span><span class="p">();</span>
<span class="p">});</span></code></pre></div>
</div>

<p>Often action creators optimistically dispatch an action before connecting to a state source. So what should you do if that action fails? Action creators will emit actions of  type <code>ACTION_FAILED</code> and <code>{Action Type}_FAILED</code> which your store can handle. Alternatively you can return a function from an action handler which will be called if the action fails or if the <a href="/v/0.9.0-rc2/api/stores/index.html#rollback">action rolled back</a>.</p>

<div class="sample">    <div class="btn-group zero-clipboard" role="group"> <button type="button" data-style="classic" class="btn btn-default classic">classic</button> <button type="button" data-style="es6" class="btn btn-default es6">es6</button> </div><div class="highlight" data-style="classic"><pre><code data-lang="js" class="language-js"><span class="kd">var</span> <span class="nx">UsersStore</span> <span class="o">=</span> <span class="nx">Marty</span><span class="p">.</span><span class="nx">createStore</span><span class="p">({</span>
  <span class="na">id</span><span class="p">:</span> <span class="s1">'UsersStore'</span><span class="p">,</span>
  <span class="na">addUser</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">[</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">user</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">hasChanged</span><span class="p">();</span>

    <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">errors</span><span class="p">[</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">error</span><span class="p">;</span>
      <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">[</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">];</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">hasChanged</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></div><div class="highlight" data-style="es6"><pre><code data-lang="js" class="language-js"><span class="kr">class</span> <span class="nx">UsersStore</span> <span class="kr">extends</span> <span class="nx">Marty</span><span class="p">.</span><span class="nx">Store</span> <span class="p">{</span>
  <span class="nx">addUser</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">[</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">user</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">hasChanged</span><span class="p">();</span>

    <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">errors</span><span class="p">[</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">error</span><span class="p">;</span>
      <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">[</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">];</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">hasChanged</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>
</div>

    </div>
  </div>
</div>

  <footer class="bs-docs-footer" role="contentinfo">
    <div class="container">
      <p>Code licensed under <a href="https://github.com/jhollingworth/marty/blob/master/LICENSE" target="_blank">MIT</a>, documentation under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.</p>
      <ul class="bs-docs-footer-links muted">
        <li>v0.9.0-rc2</li>
        <li>·</li>
        <li><a href="https://github.com/jhollingworth/marty">GitHub</a></li>
        <li>·</li>
        <li><a href="https://github.com/jhollingworth/marty/issues">Issues</a></li>
        <li>·</li>
        <li><a href="https://github.com/jhollingworth/marty/releases">Releases</a></li>
      </ul>
    </div>
  </footer>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-56575082-1', 'auto');
    ga('send', 'pageview');

  </script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script type="text/javascript" src="/v/0.9.0-rc2/js/style.js"></script>
  <script type="text/javascript" src="/v/0.9.0-rc2/js/headings.js"></script>
  <script type="text/javascript" src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
</body>
</html>